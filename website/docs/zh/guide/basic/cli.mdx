# 命令行工具

Rstest 提供了一个轻量级的命令行工具，包含 [rstest watch](#rstest-watch) 和 [rstest run](#rstest-run) 等命令。

## rstest -h

`rstest -h` 可帮助你查看所有可用的 CLI 命令及选项：

```bash
npx rstest -h
```

输出如下：

```bash
Usage:
  $ rstest [...filters]

Commands:
  [...filters]        run tests
  run [...filters]    run tests without watch mode
  watch [...filters]  run tests in watch mode
  list [...filters]   lists all test files that Rstest will run

Options:
  -w, --watch                              Run tests in watch mode
  -h, --help                               Display this message
  -v, --version                            Display version number
  -c, --config <config>
  ...
```

## rstest [...filters]

直接运行 `rstest` 命令将会在当前目录执行 Rstest 测试。

```bash
$ npx rstest

✓ test/index.test.ts (2 tests) 1ms

  Test Files 1 passed (1)
       Tests 2 passed (2)
    Duration 189 ms (build 22 ms, tests 167 ms)
```

### Watch 模式

如果你希望在文件更改时自动重新运行测试，可以使用 `--watch` 或 `rstest watch` 命令：

```bash
$ npx rstest --watch
```

## rstest run

`rstest run` 将会执行单次测试，该命令适用于 CI 环境或不需要一边修改一边执行测试的场景。

## rstest watch

`rstest watch` 将会启动监听模式并执行测试，当测试或依赖文件修改时，将重新执行关联的测试文件。

## rstest list

`rstest list` 将会打印所有匹配条件的测试列表。默认情况下，它将打印所有匹配条件的测试名称。

```bash
$ npx rstest list

# 输出如下：
a.test.ts > test a > test a-1
a.test.ts > test a-2
b.test.ts > test b > test b-1
b.test.ts > test b-2
```

`rstest list` 命令继承所有 `rstest` 过滤选项，你可以直接过滤文件或使用 `-t` 过滤指定的测试名称。

```bash
$ npx rstest list -t='test a'

# 输出如下：
a.test.ts > test a > test a-1
a.test.ts > test a-2
```

你可以使用 `--filesOnly` 使其仅打印测试文件：

```bash
$ npx rstest list --filesOnly

# 输出如下：
a.test.ts
b.test.ts
```

你可以使用 `--json` 使其以 JSON 格式打印测试或将结果保存到单独的文件中：

```bash
$ npx rstest list --json

$ npx rstest list --json=./output.json
```

您可以使用 `--includeSuites` 选项，在打印测试用例的同时输出测试套件信息：

```bash
$ npx rstest list

# 输出如下：
a.test.ts > test a
a.test.ts > test a > test a-1
a.test.ts > test a-2
b.test.ts > test b
b.test.ts > test b > test b-1
b.test.ts > test b-2
```

您可以使用 `--printLocation` 选项来打印测试的位置信息：

```bash
$ npx rstest list

# 输出如下：
a.test.ts:4:5 > test a > test a-1
a.test.ts:9:3 > test a-2
b.test.ts:4:5 > test b > test b-1
b.test.ts:9:3 > test b-2
```

## CLI 选项

Rstest CLI 支持以下常用参数，所有命令均可使用：

| 参数                            | 说明                                                                                                                                         |
| ------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| `-c, --config <config>`         | 指定配置文件路径（相对或绝对路径），详见 [指定配置文件](/guide/basic/configure-rstest#指定配置文件)                                          |
| `--config-loader <loader>`      | 指定配置加载器，可选 `jiti` 或 `native`，详见 [Rsbuild - 指定加载方式](https://rsbuild.rs/guide/configuration/rsbuild#specify-config-loader) |
| `-r, --root <root>`             | 指定项目根目录，详见 [root](/config/test/root)                                                                                               |
| `--globals`                     | 提供全局 API，详见 [globals](/config/test/globals)                                                                                           |
| `--isolate`                     | 在隔离环境中运行测试，详见 [isolate](/config/test/isolate)                                                                                   |
| `--exclude <exclude>`           | 排除指定文件，详见 [exclude](/config/test/exclude)                                                                                           |
| `-u, --update`                  | 更新快照文件，详见 [update](/config/test/update)                                                                                             |
| `--coverage`                    | 启用代码覆盖率收集，详见 [coverage](/config/test/coverage)                                                                                   |
| `--passWithNoTests`             | 当未找到测试文件时允许测试通过，详见 [passWithNoTests](/config/test/pass-with-no-tests)                                                      |
| `--printConsoleTrace`           | 调用 console 方法时打印调用栈，详见 [printConsoleTrace](/config/test/print-console-trace)                                                    |
| `--project <name>`              | 仅运行指定项目的测试，详见 [根据项目名称过滤](/guide/basic/test-filter#根据项目名称过滤)                                                     |
| `--disableConsoleIntercept`     | 禁用 console 拦截，详见 [disableConsoleIntercept](/config/test/disable-console-intercept)                                                    |
| `--slowTestThreshold <value>`   | 设置测试或套件被视为慢的阈值（毫秒），详见 [slowTestThreshold](/config/test/slow-test-threshold)                                             |
| `-t, --testNamePattern <value>` | 仅运行名称匹配正则的测试，详见 [testNamePattern](/config/test/test-name-pattern)                                                             |
| `--testEnvironment <name>`      | 指定测试环境，详见 [testEnvironment](/config/test/test-environment)                                                                          |
| `--testTimeout <value>`         | 设置单个测试的超时时间（毫秒），详见 [testTimeout](/config/test/test-timeout)                                                                |
| `--hookTimeout <value>`         | 设置单个测试 hook 的超时时间（毫秒），详见 [hookTimeout](/config/test/hook-timeout)                                                          |
| `--retry <retry>`               | 测试失败时重试次数，详见 [retry](/config/test/retry)                                                                                         |
| `--bail [number]`               | 指定个数的测试失败后停止运行，详见 [bail](/config/test/bail)                                                                                 |
| `--reporter <reporter>`         | 指定测试报告器，详见 [reporters](/config/test/reporters)                                                                                     |
| `--maxConcurrency <value>`      | 最大并发测试数，详见 [maxConcurrency](/config/test/max-concurrency)                                                                          |
| `--clearMocks`                  | 每个测试前自动清除 mock 调用、实例、上下文和结果，详见 [clearMocks](/config/test/clear-mocks)                                                |
| `--resetMocks`                  | 每个测试前自动重置 mock 状态，详见 [resetMocks](/config/test/reset-mocks)                                                                    |
| `--restoreMocks`                | 每个测试前自动恢复 mock 状态和实现，详见 [restoreMocks](/config/test/restore-mocks)                                                          |
| `--unstubGlobals`               | 每个测试前恢复被 `rstest.stubGlobal` 修改的全局变量，详见 [unstubGlobals](/config/test/unstub-globals)                                       |
| `--unstubEnvs`                  | 每个测试前恢复被 `rstest.stubEnv` 修改的 `process.env`，详见 [unstubEnvs](/config/test/unstub-envs)                                          |
| `--include <pattern>`           | 指定测试文件匹配模式，详见 [include](/config/test/include)                                                                                   |
| `--includeSource <pattern>`     | 指定源码内联测试文件匹配模式，详见 [includeSource](/config/test/include-source)                                                              |
| `--logHeapUsage`                | 打印每个测试的堆内存使用情况，详见 [logHeapUsage](/config/test/log-heap-usage)                                                               |
| `--hideSkippedTests`            | 不展示跳过测试的日志，详见 [hideSkippedTests](/config/test/hide-skipped-tests)                                                               |
| `--hideSkippedTestFiles`        | 不展示跳过测试文件的日志，详见 [hideSkippedTestFiles](/config/test/hide-skipped-test-files)                                                  |
| `--chaiConfig <config>`         | 自定义 Chai 配置，详见 [chaiConfig](/config/test/chai-config)                                                                                |
| `--env <key=value>`             | 设置环境变量，详见 [env](/config/test/env)                                                                                                   |
| `--pool <options>`              | 配置测试线程池选项，详见 [pool](/config/test/pool)                                                                                           |
| `--setupFiles <files>`          | 指定 setup 文件列表，详见 [setupFiles](/config/test/setup-files)                                                                             |
| `--snapshotFormat <options>`    | 自定义快照格式，详见 [snapshotFormat](/config/test/snapshot-format)                                                                          |
| `--resolveSnapshotPath`         | 自定义快照路径解析，详见 [resolveSnapshotPath](/config/test/resolve-snapshot-path)                                                           |
| `--onConsoleLog <handler>`      | 处理 console 日志，详见 [onConsoleLog](/config/test/on-console-log)                                                                          |
| `--name <name>`                 | 设置测试套件名称，详见 [name](/config/test/name)                                                                                             |
| `--projects <projects>`         | 配置多项目测试，详见 [projects](/config/test/projects)                                                                                       |
| `-h, --help`                    | 显示帮助信息                                                                                                                                 |
| `-v, --version`                 | 显示版本号                                                                                                                                   |

### 布尔选项取反

对于布尔类型的选项，你可以使用 `--no-<option>` 前缀来将其设置为 `false`。例如：

```bash
# 以下两种写法等价：
npx rstest --isolate false
npx rstest --no-isolate

# 更多示例：
npx rstest --no-coverage      # 禁用覆盖率
npx rstest --no-globals        # 禁用全局 API
npx rstest --no-clearMocks     # 禁用自动清除 mock
```

## CLI 快捷键

在 watch 模式下运行 Rstest 时，你可以使用键盘快捷键来执行各种便捷操作。

所有快捷键：

```bash
  Shortcuts:
  f  rerun failed tests
  a  rerun all tests
  u  update snapshot
  t  filter by a test name regex pattern
  p  filter by a filename regex pattern
  q  quit process
  c  clear screen
  h  show shortcuts help
```

:::note
CLI 快捷键仅在 watch 模式下运行 Rstest（`rstest watch` 或 `rstest --watch`）且终端支持 TTY（交互模式）时可用。
:::
